box: python:3.5
# services:
#    - id: postgres
#      env:
#        POSTGRES_PASSWORD: stopmakingsense
#        POSTGRES_USER: cerealkiller
#        POSTGRES_DB: serialbox
dev:
  steps:
    - add-ssh-key:
        keyname: SERIALBOX_KEY
        
    - add-to-known_hosts:
        hostname: bitbucket.org
        fingerprint: 97:8c:1b:f2:6f:14:6b:5c:3b:ec:aa:46:46:74:7c:40
        type: rsa
        
    - pip-install
    
    - script:
        name: python unit test
        code: |
          python manage.py makemigrations
          python manage.py collectstatic --noinput
          python manage.py migrate
          python manage.py test random_flavorpack
build:
  steps:
    - add-ssh-key:
        keyname: SERIALBOX_KEY
        
    - add-to-known_hosts:
        hostname: bitbucket.org
        fingerprint: 97:8c:1b:f2:6f:14:6b:5c:3b:ec:aa:46:46:74:7c:40
        type: rsa
        
    - pip-install
    
    - script:
        name: python unit test
        code: |
          python manage.py makemigrations
          python manage.py collectstatic --noinput
          python manage.py migrate
          python manage.py test random_flavorpack
  after-steps:
    - slack-notifier:
        url: $SLACK_URL
        channel: builds
        username: buildbot